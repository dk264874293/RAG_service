# 向量管理模块文档

> **版本**: 1.0.0
> **更新日期**: 2026-01-29
> **模块**: 前端向量管理

---

## 📚 目录

- [功能概览](#功能概览)
- [新增功能](#新增功能)
- [功能说明](#功能说明)
- [UI界面](#ui界面)
- [技术实现](#技术实现)
- [API使用](#api使用)
- [使用方法](#使用方法)
- [注意事项](#注意事项)
- [界面优化](#界面优化)
- [常见问题](#常见问题)
- [功能验证](#功能验证)
- [技术栈](#技术栈)
- [未来优化方向](#未来优化方向)

---

## 功能概览

向量管理模块提供了完整的文档向量化管理功能，包括文件上传、索引、搜索和删除等操作。

### 核心能力

- 📤 文档上传（支持批量）
- 🔍 向量搜索
- 🗑️ 向量删除（支持软删除）
- 📊 向量统计
- 🔄 实时状态更新

---

## 新增功能

### 1. 文档上传功能

- ✅ 支持单个文件上传
- ✅ 支持批量文件上传
- ✅ 自动索引到向量数据库
- ✅ 实时显示上传进度
- ✅ 文件类型提示（PDF、Word、TXT、Markdown）

### 2. 文件列表显示

- ✅ 显示所有已索引的文档
- ✅ 显示文件状态（成功/失败/处理中）
- ✅ 显示文件名、类型、大小、上传时间
- ✅ 支持文件搜索功能
- ✅ 可折叠/展开列表视图

### 3. 向量删除功能

- ✅ 删除文件同时删除关联的所有向量
- ✅ 删除确认对话框（防止误删）
- ✅ 显示删除的向量数量
- ✅ 自动刷新向量统计信息

### 4. 实时状态更新

- ✅ 上传成功后自动刷新文件列表
- ✅ 删除文件后自动更新向量统计
- ✅ 成功/错误消息提示
- ✅ 自动加载索引状态

---

## 功能说明

### 文件上传流程

```
1. 选择文件（支持多选）
   ↓
2. 点击"上传文件"按钮
   ↓
3. 系统自动处理：
   - 文件内容提取
   - 文档分块
   - 向量化处理
   - 索引到FAISS数据库
   ↓
4. 上传完成，显示成功消息
   ↓
5. 自动刷新文件列表和向量统计
```

### 文件删除流程

```
1. 点击删除按钮（🗑️）
   ↓
2. 确认删除对话框
   ↓
3. 系统执行：
   - 标记文件为删除
   - 软删除关联的所有向量
   - 更新向量统计
   ↓
4. 显示删除结果（包含删除的向量数量）
```

### 文件状态说明

| 状态 | 图标 | 说明 |
|------|------|------|
| Success | ✅ | 文件已成功索引到向量数据库 |
| Failed | ❌ | 文件处理失败，未索引 |
| Processing | ⏳ | 文件正在处理中 |

---

## UI界面

### 页面布局

```
┌─────────────────────────────────────────────────┐
│  向量管理                  [刷新按钮]    │
├─────────────────────────────────────────────────┤
│  统计卡片区域（4个卡片）                 │
│  - 总向量数                                 │
│  - 活跃向量                                 │
│  - 已删除向量                               │
│  - 向量维度                                 │
├─────────────────────────────────────────────────┤
│  详细信息区域                                │
│  - 索引使用情况（进度条）                    │
│  - 系统信息（索引路径、维度等）                │
├─────────────────────────────────────────────────┤
│  上传文档到向量库                             │
│  [选择文件输入框]  [上传文件按钮]            │
│  已选择 X 个文件                              │
├─────────────────────────────────────────────────┤
│  已索引文档列表          共 X 个文件    [展开/收起]│
│  [搜索框...]                                │
│  ┌──┬─────┬──────┬──────┬────────┬────┐ │
│  │状态│文件名 │ 类型  │大小  │时间    │操作  │ │
│  ├──┼─────┼──────┼──────┼────────┼────┤ │
│  │✅  │doc.pdf│ PDF  │2.5MB │时间   │🗑️  │ │
│  │✅  │test.md│MD   │5KB   │时间   │🗑️  │ │
│  └──┴─────┴──────┴──────┴────────┴────┘ │
├─────────────────────────────────────────────────┤
│  向量管理说明                                │
│  [功能说明卡片]                             │
└─────────────────────────────────────────────────┘
```

---

## 技术实现

### 新增状态管理

```typescript
const [files, setFiles] = useState<UploadedFile[]>([]);
const [uploading, setUploading] = useState(false);
const [selectedFiles, setSelectedFiles] = useState<FileList | null>(null);
const [searchQuery, setSearchQuery] = useState('');
const [showFiles, setShowFiles] = useState(false);
```

### 新增函数

#### handleFileSelect
处理文件选择事件，更新 `selectedFiles` 状态。

#### handleUpload
上传文件到后端API：
- 单个文件：调用 `documentService.uploadFile()`
- 批量文件：调用 `documentService.uploadBatch()`
- 上传成功后刷新文件列表和向量统计

#### handleDelete
删除文件及关联向量：
- 调用 `documentService.deleteFile()`
- 显示删除的向量数量
- 刷新文件列表和向量统计

#### loadFiles
加载已上传文件列表：
- 调用 `documentService.getUploadHistory(50)`
- 限制返回50条记录

#### filteredFiles
根据搜索查询过滤文件列表。

#### getStatusIcon
根据文件状态返回相应的图标。

#### formatFileSize
格式化文件大小（B/KB/MB）。

---

## API使用

### 上传API

```typescript
// 单个文件上传
await documentService.uploadFile(file)

// 批量文件上传
await documentService.uploadBatch(files)
```

### 删除API

```typescript
// 删除文件（同时删除关联向量）
const response = await documentService.deleteFile(fileId)
// 返回: { status, message, deleted_vectors }
```

### 获取文件列表API

```typescript
// 获取已上传文件历史
const data = await documentService.getUploadHistory(50)
// 返回: { items: UploadedFile[], total: number }
```

---

## 使用方法

### 步骤 1: 访问向量管理页面

1. 登录系统
2. 点击导航栏的"向量管理"
3. 或直接访问：`http://localhost:3000/vectors`

### 步骤 2: 上传文件

1. 点击"选择文件"按钮
2. 选择一个或多个文件（PDF、Word、TXT、Markdown）
3. 点击"上传文件"按钮
4. 等待上传完成
5. 查看成功消息和文件列表更新

### 步骤 3: 查看已索引文件

1. 点击"展开"按钮显示文件列表
2. 查看文件状态、大小、上传时间
3. 使用搜索框筛选文件

### 步骤 4: 删除文件

1. 找到要删除的文件
2. 点击右侧的删除按钮（🗑️）
3. 确认删除操作
4. 查看删除结果消息

---

## 注意事项

### 文件上传

#### 1. 文件大小限制
- 单个文件最大 10MB
- 超过限制的文件将被拒绝

#### 2. 文件类型支持
- ✅ PDF (.pdf)
- ✅ Word (.doc, .docx)
- ✅ 纯文本 (.txt)
- ✅ Markdown (.md)
- ✅ HTML (.html)
- ✅ PowerPoint (.pptx)
- ✅ Excel (.xlsx)

#### 3. 上传时间
- 小文件（< 1MB）：通常几秒
- 中等文件（1-5MB）：通常10-30秒
- 大文件（5-10MB）：可能需要1-2分钟

### 文件删除

#### 1. 不可恢复
- 删除后无法恢复
- 建议删除前确认

#### 2. 软删除机制
- 向量使用软删除，标记后不再返回
- 定期重建索引以清理软删除数据

#### 3. 向量数量
- 删除操作会返回删除的向量数量
- 根据文档分块数量而定

---

## 界面优化

### 响应式设计
- ✅ 移动端友好
- ✅ 平板端适配
- ✅ 桌面端优化

### 深色模式
- ✅ 自动适配系统主题
- ✅ 所有组件支持深色模式
- ✅ 高对比度可读性

### 动画效果
- ✅ 加载动画
- ✅ 悬停效果
- ✅ 过渡动画
- ✅ 淡入淡出效果

---

## 常见问题

### Q1: 上传文件后看不到在列表中
**A**: 等待几秒钟，系统正在处理和索引。如果超过1分钟仍未出现，刷新页面。

### Q2: 删除文件后向量数量没有变化
**A**: 删除向量使用软删除，统计中的"已删除向量"会增加。如需物理删除，需要重建索引。

### Q3: 批量上传时部分文件失败
**A**: 系统会显示成功和失败的数量。失败的文件不会被索引。检查文件格式和大小是否符合要求。

### Q4: 上传大文件时超时
**A**:
- 检查网络连接
- 考虑将大文件分成多个小文件
- 检查后端日志是否有错误

---

## 功能验证

### 上传功能
- [x] 可以选择单个文件
- [x] 可以选择多个文件
- [x] 上传成功显示消息
- [x] 上传失败显示错误
- [x] 自动刷新文件列表
- [x] 自动刷新向量统计

### 文件列表
- [x] 显示所有已索引文件
- [x] 显示文件状态图标
- [x] 显示文件类型标签
- [x] 显示文件大小
- [x] 显示上传时间
- [x] 搜索过滤功能正常

### 删除功能
- [x] 点击删除显示确认对话框
- [x] 确认后成功删除
- [x] 显示删除的向量数量
- [x] 自动刷新统计信息
- [x] 文件从列表中移除

---

## 技术栈

- **React** - UI 框架
- **TypeScript** - 类型安全
- **Axios** - HTTP 客户端
- **Tailwind CSS** - 样式框架
- **Lucide React** - 图标库

---

## 未来优化方向

### 1. 性能优化
- 添加分页加载（大文件列表）
- 实现虚拟滚动
- 优化大文件上传进度

### 2. 功能增强
- 添加拖拽上传功能
- 支持文件夹上传
- 添加上传暂停/取消功能
- 显示上传进度条

### 3. 用户体验
- 添加文件预览功能
- 支持文件重命名
- 添加文件下载功能
- 实现批量删除

### 4. 向量管理
- 添加向量重建按钮
- 显示向量索引大小
- 添加向量导出功能
- 支持向量相似度分析

---

**文档版本**: 1.0.0
**最后更新**: 2026-01-29
