name: compliance_checker_agent
version: 1.0.0
description: |
  合规性检查智能体
  负责环境监测数据的合规性检查，包括数据提取、标准匹配、
  公式计算和合规性判断。

capabilities:
  - PDF数据提取（项目、方法、公式、结果）
  - 国标标准智能匹配
  - 公式计算验证
  - 合规性判断
  - 合规性报告生成

dependencies:
  - src.service.compliance_service.ComplianceCheckService
  - src.compliance.standard_matcher.StandardMatcher
  - src.compliance.formula_calculator.FormulaCalculator
  - src.extractor.analysis_data_extractor.AnalysisDataExtractor
  - src.vector.retrieval_service.RetrievalService

input_format:
  type: object
  properties:
    test_pdf_path:
      type: string
      description: 测试PDF文件路径
    enable_formula_calculation:
      type: boolean
      default: true
      description: 是否启用公式计算验证
    enable_vector_retrieval:
      type: boolean
      default: true
      description: 是否启用向量检索匹配标准
    gb_directory:
      type: string
      default: src/pdfs/GB
      description: 国标目录路径

output_format:
  type: object
  properties:
    compliant_count:
      type: integer
    non_compliant_count:
      type: integer
    items:
      type: array
      items:
        type: object
        properties:
          project_name:
            type: string
          method_basis:
            type: string
          formula:
            type: string
          measured_value:
            type: number
          unit:
            type: string
          standard:
            type: object
          is_compliant:
            type: boolean
          violation_reason:
            type: string

workflow:
  - step: extract_data
    description: 从PDF提取分析数据
    handler: extract_analysis_data
  - step: match_standards
    description: 匹配国标标准
    handler: match_standard
    strategy:
      - direct_mapping
      - method_basis_extraction
      - leaching_limits_check
      - toxic_substance_limits_check
      - vector_retrieval
  - step: verify_formula
    description: 验证公式计算（可选）
    handler: verify_formula_calculation
    condition: enable_formula_calculation
  - step: check_compliance
    description: 检查合规性
    handler: check_compliance
  - step: generate_report
    description: 生成合规性报告
    handler: generate_report

supported_standards:
  - GB 5085.1-2007  # 危险废物鉴别标准 腐蚀性鉴别
  - GB 5085.2-2007  # 危险废物鉴别标准 急性毒性初筛
  - GB 5085.3-2007  # 危险废物鉴别标准 浸出毒性鉴别
  - GB 5085.4-2007  # 危险废物鉴别标准 易燃性鉴别
  - GB 5085.5-2007  # 危险废物鉴别标准 反应性鉴别
  - GB 5085.6-2017  # 危险废物鉴别标准 毒性物质含量鉴别
  - GB 34330-2017   # 固体废物鉴别标准 通则
  - GB 3838-2002    # 地表水环境质量标准

error_handling:
  PDFExtractionError:
    message: PDF数据提取失败
    action: 记录日志，返回错误详情
  StandardMatchError:
    message: 标准匹配失败
    action: 使用默认限值或跳过

performance:
  max_pdf_size_mb: 50
  ocr_enabled: true
  vector_retrieval_k: 3
